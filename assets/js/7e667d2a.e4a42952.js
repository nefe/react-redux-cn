"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[879],{3905:(e,t,n)=>{n.d(t,{Zo:()=>l,kt:()=>h});var o=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function p(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=o.createContext({}),c=function(e){var t=o.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},l=function(e){var t=c(e.components);return o.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},u=o.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,s=e.parentName,l=p(e,["components","mdxType","originalType","parentName"]),u=c(n),h=a,m=u["".concat(s,".").concat(h)]||u[h]||d[h]||r;return n?o.createElement(m,i(i({ref:t},l),{},{components:n})):o.createElement(m,i({ref:t},l))}));function h(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,i=new Array(r);i[0]=u;var p={};for(var s in t)hasOwnProperty.call(t,s)&&(p[s]=t[s]);p.originalType=e,p.mdxType="string"==typeof e?e:a,i[1]=p;for(var c=2;c<r;c++)i[c]=n[c];return o.createElement.apply(null,i)}return o.createElement.apply(null,n)}u.displayName="MDXCreateElement"},3931:(e,t,n)=>{n.r(t),n.d(t,{contentTitle:()=>s,default:()=>u,frontMatter:()=>p,metadata:()=>c,toc:()=>l});var o=n(7462),a=n(3366),r=(n(7294),n(3905)),i=["components"],p={id:"usage-with-typescript",title:"Usage with TypeScript",hide_title:!0,sidebar_label:"Usage with TypeScript",description:"Usage > TypeScript: how to correctly type React Redux APIs"},s=void 0,c={unversionedId:"using-react-redux/usage-with-typescript",id:"using-react-redux/usage-with-typescript",isDocsHomePage:!1,title:"Usage with TypeScript",description:"Usage > TypeScript: how to correctly type React Redux APIs",source:"@site/../docs/using-react-redux/usage-with-typescript.md",sourceDirName:"using-react-redux",slug:"/using-react-redux/usage-with-typescript",permalink:"/react-redux-in-chinese/using-react-redux/usage-with-typescript",editUrl:"https://github.com/reduxjs/react-redux/edit/master/website/../docs/using-react-redux/usage-with-typescript.md",tags:[],version:"current",lastUpdatedAt:1659003295,formattedLastUpdatedAt:"7/28/2022",frontMatter:{id:"usage-with-typescript",title:"Usage with TypeScript",hide_title:!0,sidebar_label:"Usage with TypeScript",description:"Usage > TypeScript: how to correctly type React Redux APIs"},sidebar:"docs",previous:{title:"Tutorial: Connect API",permalink:"/react-redux-in-chinese/tutorials/connect"},next:{title:"Connect: Extracting Data with mapStateToProps",permalink:"/react-redux-in-chinese/using-react-redux/connect-mapstate"}},l=[{value:"Standard Redux Toolkit Project Setup with TypeScript",id:"standard-redux-toolkit-project-setup-with-typescript",children:[{value:"Define Root State and Dispatch Types",id:"define-root-state-and-dispatch-types",children:[],level:3},{value:"Define Typed Hooks",id:"define-typed-hooks",children:[],level:3}],level:2},{value:"Typing Hooks Manually",id:"typing-hooks-manually",children:[{value:"Typing the <code>useSelector</code> hook",id:"typing-the-useselector-hook",children:[],level:3},{value:"Typing the <code>useDispatch</code> hook",id:"typing-the-usedispatch-hook",children:[],level:3}],level:2},{value:"Typing the <code>connect</code> higher order component",id:"typing-the-connect-higher-order-component",children:[{value:"Inferring The Connected Props Automatically",id:"inferring-the-connected-props-automatically",children:[],level:3},{value:"Manually Typing <code>connect</code>",id:"manually-typing-connect",children:[],level:3}],level:2},{value:"Recommendations",id:"recommendations",children:[],level:2},{value:"Resources",id:"resources",children:[],level:2}],d={toc:l};function u(e){var t=e.components,n=(0,a.Z)(e,i);return(0,r.kt)("wrapper",(0,o.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"usage-with-typescript"},"Usage with TypeScript"),(0,r.kt)("p",null,"As of React-Redux v8, React-Redux is fully written in TypeScript, and the types are included in the published package. The types also export some helpers to make it easier to write typesafe interfaces between your Redux store and your React components."),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"The recently updated ",(0,r.kt)("inlineCode",{parentName:"p"},"@types/react@18")," major version has changed component definitions to remove having ",(0,r.kt)("inlineCode",{parentName:"p"},"children")," as a prop by default. This causes errors if you have multiple copies of ",(0,r.kt)("inlineCode",{parentName:"p"},"@types/react")," in your project. To fix this, tell your package manager to resolve ",(0,r.kt)("inlineCode",{parentName:"p"},"@types/react")," to a single version. Details:"),(0,r.kt)("p",{parentName:"div"},(0,r.kt)("a",{parentName:"p",href:"https://github.com/facebook/react/issues/24304#issuecomment-1094565891"},"https://github.com/facebook/react/issues/24304#issuecomment-1094565891")))),(0,r.kt)("h2",{id:"standard-redux-toolkit-project-setup-with-typescript"},"Standard Redux Toolkit Project Setup with TypeScript"),(0,r.kt)("p",null,"We assume that a typical Redux project is using Redux Toolkit and React Redux together."),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://redux-toolkit.js.org"},"Redux Toolkit")," (RTK) is the standard approach for writing modern Redux logic. RTK is already written in TypeScript, and its API is designed to provide a good experience for TypeScript usage."),(0,r.kt)("p",null,"The ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/reduxjs/cra-template-redux-typescript"},"Redux+TS template for Create-React-App")," comes with a working example of these patterns already configured."),(0,r.kt)("h3",{id:"define-root-state-and-dispatch-types"},"Define Root State and Dispatch Types"),(0,r.kt)("p",null,"Using ",(0,r.kt)("a",{parentName:"p",href:"https://redux-toolkit.js.org/api/configureStore"},"configureStore")," should not need any additional typings. You will, however, want to extract the ",(0,r.kt)("inlineCode",{parentName:"p"},"RootState")," type and the ",(0,r.kt)("inlineCode",{parentName:"p"},"Dispatch")," type so that they can be referenced as needed. Inferring these types from the store itself means that they correctly update as you add more state slices or modify middleware settings."),(0,r.kt)("p",null,"Since those are types, it's safe to export them directly from your store setup file such as ",(0,r.kt)("inlineCode",{parentName:"p"},"app/store.ts")," and import them directly into other files."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="app/store.ts"',title:'"app/store.ts"'},"import { configureStore } from '@reduxjs/toolkit'\n// ...\n\nconst store = configureStore({\n  reducer: {\n    posts: postsReducer,\n    comments: commentsReducer,\n    users: usersReducer,\n  },\n})\n\n// highlight-start\n// Infer the `RootState` and `AppDispatch` types from the store itself\nexport type RootState = ReturnType<typeof store.getState>\n// Inferred type: {posts: PostsState, comments: CommentsState, users: UsersState}\nexport type AppDispatch = typeof store.dispatch\n// highlight-end\n")),(0,r.kt)("h3",{id:"define-typed-hooks"},"Define Typed Hooks"),(0,r.kt)("p",null,"While it's possible to import the ",(0,r.kt)("inlineCode",{parentName:"p"},"RootState")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"AppDispatch")," types into each component, it's better to ",(0,r.kt)("strong",{parentName:"p"},"create pre-typed versions of the ",(0,r.kt)("inlineCode",{parentName:"strong"},"useDispatch")," and ",(0,r.kt)("inlineCode",{parentName:"strong"},"useSelector")," hooks for usage in your application"),". This is important for a couple reasons:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"For ",(0,r.kt)("inlineCode",{parentName:"li"},"useSelector"),", it saves you the need to type ",(0,r.kt)("inlineCode",{parentName:"li"},"(state: RootState)")," every time"),(0,r.kt)("li",{parentName:"ul"},"For ",(0,r.kt)("inlineCode",{parentName:"li"},"useDispatch"),", the default ",(0,r.kt)("inlineCode",{parentName:"li"},"Dispatch")," type does not know about thunks or other middleware. In order to correctly dispatch thunks, you need to use the specific customized ",(0,r.kt)("inlineCode",{parentName:"li"},"AppDispatch")," type from the store that includes the thunk middleware types, and use that with ",(0,r.kt)("inlineCode",{parentName:"li"},"useDispatch"),". Adding a pre-typed ",(0,r.kt)("inlineCode",{parentName:"li"},"useDispatch")," hook keeps you from forgetting to import ",(0,r.kt)("inlineCode",{parentName:"li"},"AppDispatch")," where it's needed.")),(0,r.kt)("p",null,"Since these are actual variables, not types, it's important to define them in a separate file such as ",(0,r.kt)("inlineCode",{parentName:"p"},"app/hooks.ts"),", not the store setup file. This allows you to import them into any component file that needs to use the hooks, and avoids potential circular import dependency issues."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="app/hooks.ts"',title:'"app/hooks.ts"'},"import { TypedUseSelectorHook, useDispatch, useSelector } from 'react-redux'\nimport type { RootState, AppDispatch } from './store'\n\n// highlight-start\n// Use throughout your app instead of plain `useDispatch` and `useSelector`\nexport const useAppDispatch: () => AppDispatch = useDispatch\nexport const useAppSelector: TypedUseSelectorHook<RootState> = useSelector\n// highlight-end\n")),(0,r.kt)("h2",{id:"typing-hooks-manually"},"Typing Hooks Manually"),(0,r.kt)("p",null,"We recommend using the pre-typed ",(0,r.kt)("inlineCode",{parentName:"p"},"useAppSelector")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"useAppDispatch")," hooks shown above. If you prefer not to use those, here is how to type the hooks by themselves."),(0,r.kt)("h3",{id:"typing-the-useselector-hook"},"Typing the ",(0,r.kt)("inlineCode",{parentName:"h3"},"useSelector")," hook"),(0,r.kt)("p",null,"When writing selector functions for use with ",(0,r.kt)("inlineCode",{parentName:"p"},"useSelector"),", you should explicitly define the type of the ",(0,r.kt)("inlineCode",{parentName:"p"},"state")," parameter. TS should be able to then infer the return type of the selector, which will be reused as the return type of the ",(0,r.kt)("inlineCode",{parentName:"p"},"useSelector")," hook:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"interface RootState {\n  isOn: boolean\n}\n\n// TS infers type: (state: RootState) => boolean\nconst selectIsOn = (state: RootState) => state.isOn\n\n// TS infers `isOn` is boolean\nconst isOn = useSelector(selectIsOn)\n")),(0,r.kt)("p",null,"This can also be done inline as well:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const isOn = useSelector((state: RootState) => state.isOn)\n")),(0,r.kt)("h3",{id:"typing-the-usedispatch-hook"},"Typing the ",(0,r.kt)("inlineCode",{parentName:"h3"},"useDispatch")," hook"),(0,r.kt)("p",null,"By default, the return value of ",(0,r.kt)("inlineCode",{parentName:"p"},"useDispatch")," is the standard ",(0,r.kt)("inlineCode",{parentName:"p"},"Dispatch")," type defined by the Redux core types, so no declarations are needed:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const dispatch = useDispatch()\n")),(0,r.kt)("p",null,"If you have a customized version of the ",(0,r.kt)("inlineCode",{parentName:"p"},"Dispatch")," type, you may use that type explicitly:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"// store.ts\nexport type AppDispatch = typeof store.dispatch\n\n// MyComponent.tsx\nconst dispatch: AppDispatch = useDispatch()\n")),(0,r.kt)("h2",{id:"typing-the-connect-higher-order-component"},"Typing the ",(0,r.kt)("inlineCode",{parentName:"h2"},"connect")," higher order component"),(0,r.kt)("h3",{id:"inferring-the-connected-props-automatically"},"Inferring The Connected Props Automatically"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"connect")," consists of two functions that are called sequentially. The first function accepts ",(0,r.kt)("inlineCode",{parentName:"p"},"mapState")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"mapDispatch")," as arguments, and returns a second function. The second function accepts the component to be wrapped, and returns a new wrapper component that passes down the props from ",(0,r.kt)("inlineCode",{parentName:"p"},"mapState")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"mapDispatch"),". Normally, both functions are called together, like ",(0,r.kt)("inlineCode",{parentName:"p"},"connect(mapState, mapDispatch)(MyComponent)"),"."),(0,r.kt)("p",null,"The package includes a helper type, ",(0,r.kt)("inlineCode",{parentName:"p"},"ConnectedProps"),", that can extract the return types of ",(0,r.kt)("inlineCode",{parentName:"p"},"mapStateToProps")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"mapDispatchToProps")," from the first function. This means that if you split the ",(0,r.kt)("inlineCode",{parentName:"p"},"connect"),' call into two steps, all of the "props from Redux" can be inferred automatically without having to write them by hand. While this approach may feel unusual if you\'ve been using React-Redux for a while, it does simplify the type declarations considerably.'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"import { connect, ConnectedProps } from 'react-redux'\n\ninterface RootState {\n  isOn: boolean\n}\n\nconst mapState = (state: RootState) => ({\n  isOn: state.isOn,\n})\n\nconst mapDispatch = {\n  toggleOn: () => ({ type: 'TOGGLE_IS_ON' }),\n}\n\nconst connector = connect(mapState, mapDispatch)\n\n// The inferred type will look like:\n// {isOn: boolean, toggleOn: () => void}\ntype PropsFromRedux = ConnectedProps<typeof connector>\n")),(0,r.kt)("p",null,"The return type of ",(0,r.kt)("inlineCode",{parentName:"p"},"ConnectedProps")," can then be used to type your props object."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx"},"interface Props extends PropsFromRedux {\n  backgroundColor: string\n}\n\nconst MyComponent = (props: Props) => (\n  <div style={{ backgroundColor: props.backgroundColor }}>\n    <button onClick={props.toggleOn}>\n      Toggle is {props.isOn ? 'ON' : 'OFF'}\n    </button>\n  </div>\n)\n\nexport default connector(MyComponent)\n")),(0,r.kt)("p",null,"Because types can be defined in any order, you can still declare your component before declaring the connector if you want."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx"},"// alternately, declare `type Props = PropsFromRedux & {backgroundColor: string}`\ninterface Props extends PropsFromRedux {\n  backgroundColor: string;\n}\n\nconst MyComponent = (props: Props) => /* same as above */\n\nconst connector = connect(/* same as above*/)\n\ntype PropsFromRedux = ConnectedProps<typeof connector>\n\nexport default connector(MyComponent)\n")),(0,r.kt)("h3",{id:"manually-typing-connect"},"Manually Typing ",(0,r.kt)("inlineCode",{parentName:"h3"},"connect")),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"connect")," higher-order component is somewhat complex to type, because there are 3 sources of props: ",(0,r.kt)("inlineCode",{parentName:"p"},"mapStateToProps"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"mapDispatchToProps"),", and props passed in from the parent component. Here's a full example of what it looks like to do that manually."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx"},"import { connect } from 'react-redux'\n\ninterface StateProps {\n  isOn: boolean\n}\n\ninterface DispatchProps {\n  toggleOn: () => void\n}\n\ninterface OwnProps {\n  backgroundColor: string\n}\n\ntype Props = StateProps & DispatchProps & OwnProps\n\nconst mapState = (state: RootState) => ({\n  isOn: state.isOn,\n})\n\nconst mapDispatch = {\n  toggleOn: () => ({ type: 'TOGGLE_IS_ON' }),\n}\n\nconst MyComponent = (props: Props) => (\n  <div style={{ backgroundColor: props.backgroundColor }}>\n    <button onClick={props.toggleOn}>\n      Toggle is {props.isOn ? 'ON' : 'OFF'}\n    </button>\n  </div>\n)\n\n// Typical usage: `connect` is called after the component is defined\nexport default connect<StateProps, DispatchProps, OwnProps>(\n  mapState,\n  mapDispatch\n)(MyComponent)\n")),(0,r.kt)("p",null,"It is also possible to shorten this somewhat, by inferring the types of ",(0,r.kt)("inlineCode",{parentName:"p"},"mapState")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"mapDispatch"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const mapState = (state: RootState) => ({\n  isOn: state.isOn,\n})\n\nconst mapDispatch = {\n  toggleOn: () => ({ type: 'TOGGLE_IS_ON' }),\n}\n\ntype StateProps = ReturnType<typeof mapState>\ntype DispatchProps = typeof mapDispatch\n\ntype Props = StateProps & DispatchProps & OwnProps\n")),(0,r.kt)("p",null,"However, inferring the type of ",(0,r.kt)("inlineCode",{parentName:"p"},"mapDispatch")," this way will break if it is defined as an object and also refers to thunks."),(0,r.kt)("h2",{id:"recommendations"},"Recommendations"),(0,r.kt)("p",null,"The hooks API is generally simpler to use with static types. ",(0,r.kt)("strong",{parentName:"p"},"If you're looking for the easiest solution for using static types with React-Redux, use the hooks API.")),(0,r.kt)("p",null,"If you're using ",(0,r.kt)("inlineCode",{parentName:"p"},"connect"),", ",(0,r.kt)("strong",{parentName:"p"},"we recommend using the ",(0,r.kt)("inlineCode",{parentName:"strong"},"ConnectedProps<T>")," approach for inferring the props from Redux"),", as that requires the fewest explicit type declarations."),(0,r.kt)("h2",{id:"resources"},"Resources"),(0,r.kt)("p",null,"For additional information, see these additional resources:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://redux.js.org/recipes/usage-with-typescript"},"Redux docs: Usage with TypeScript"),": Examples of how to use Redux Toolkit, the Redux core, and React Redux with TypeScript"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://redux-toolkit.js.org/tutorials/typescript"},"Redux Toolkit docs: TypeScript Quick start"),": shows how to use RTK and the React-Redux hooks API with TypeScript"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/typescript-cheatsheets/react-typescript-cheatsheet"},"React+TypeScript Cheatsheet"),": a comprehensive guide to using React with TypeScript"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/piotrwitek/react-redux-typescript-guide"},"React + Redux in TypeScript Guide"),": extensive information on patterns for using React and Redux with TypeScript")))}u.isMDXComponent=!0}}]);