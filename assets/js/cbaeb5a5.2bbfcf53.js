"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[611],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>m});var o=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},a=Object.keys(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var i=o.createContext({}),d=function(e){var t=o.useContext(i),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},u=function(e){var t=d(e.components);return o.createElement(i.Provider,{value:t},e.children)},l={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},p=o.forwardRef((function(e,t){var n=e.components,r=e.mdxType,a=e.originalType,i=e.parentName,u=c(e,["components","mdxType","originalType","parentName"]),p=d(n),m=r,h=p["".concat(i,".").concat(m)]||p[m]||l[m]||a;return n?o.createElement(h,s(s({ref:t},u),{},{components:n})):o.createElement(h,s({ref:t},u))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=n.length,s=new Array(a);s[0]=p;var c={};for(var i in t)hasOwnProperty.call(t,i)&&(c[i]=t[i]);c.originalType=e,c.mdxType="string"==typeof e?e:r,s[1]=c;for(var d=2;d<a;d++)s[d]=n[d];return o.createElement.apply(null,s)}return o.createElement.apply(null,n)}p.displayName="MDXCreateElement"},7774:(e,t,n)=>{n.r(t),n.d(t,{contentTitle:()=>i,default:()=>p,frontMatter:()=>c,metadata:()=>d,toc:()=>u});var o=n(7462),r=n(3366),a=(n(7294),n(3905)),s=["components"],c={id:"accessing-store",title:"Accessing the Store",hide_title:!0,sidebar_label:"Accessing the Store",description:"Usage > Accessing the Store: techniques for getting the store in your components"},i=void 0,d={unversionedId:"using-react-redux/accessing-store",id:"using-react-redux/accessing-store",isDocsHomePage:!1,title:"Accessing the Store",description:"Usage > Accessing the Store: techniques for getting the store in your components",source:"@site/../docs/using-react-redux/accessing-store.md",sourceDirName:"using-react-redux",slug:"/using-react-redux/accessing-store",permalink:"/react-redux-cn/using-react-redux/accessing-store",editUrl:"https://github.com/reduxjs/react-redux/edit/master/website/../docs/using-react-redux/accessing-store.md",tags:[],version:"current",lastUpdatedAt:1659003295,formattedLastUpdatedAt:"7/28/2022",frontMatter:{id:"accessing-store",title:"Accessing the Store",hide_title:!0,sidebar_label:"Accessing the Store",description:"Usage > Accessing the Store: techniques for getting the store in your components"},sidebar:"docs",previous:{title:"Connect: Dispatching Actions with mapDispatchToProps",permalink:"/react-redux-cn/using-react-redux/connect-mapdispatch"},next:{title:"Provider",permalink:"/react-redux-cn/api/provider"}},u=[{value:"Understanding Context Usage",id:"understanding-context-usage",children:[],level:2},{value:"Using the <code>useStore</code> Hook",id:"using-the-usestore-hook",children:[],level:2},{value:"Providing Custom Context",id:"providing-custom-context",children:[{value:"Custom Context and the hooks API",id:"custom-context-and-the-hooks-api",children:[],level:3}],level:2},{value:"Multiple Stores",id:"multiple-stores",children:[],level:2},{value:"Using <code>ReactReduxContext</code> Directly",id:"using-reactreduxcontext-directly",children:[],level:2},{value:"Further Resources",id:"further-resources",children:[],level:2}],l={toc:u};function p(e){var t=e.components,n=(0,r.Z)(e,s);return(0,a.kt)("wrapper",(0,o.Z)({},l,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"accessing-the-store"},"Accessing the Store"),(0,a.kt)("p",null,"React Redux provides APIs that allow your components to dispatch actions and subscribe to data updates from the store."),(0,a.kt)("p",null,"As part of that, React Redux abstracts away the details of which store you are using, and the exact details of how that\nstore interaction is handled. In typical usage, your own components should never need to care about those details, and\nwon't ever reference the store directly. React Redux also internally handles the details of how the store and state are\npropagated to connected components, so that this works as expected by default."),(0,a.kt)("p",null,"However, there may be certain use cases where you may need to customize how the store and state are propagated to\nconnected components, or access the store directly. Here are some examples of how to do this."),(0,a.kt)("h2",{id:"understanding-context-usage"},"Understanding Context Usage"),(0,a.kt)("p",null,"Internally, React Redux uses ",(0,a.kt)("a",{parentName:"p",href:"https://reactjs.org/docs/context.html"},'React\'s "context" feature')," to make the\nRedux store accessible to deeply nested connected components. As of React Redux version 6, this is normally handled\nby a single default context object instance generated by ",(0,a.kt)("inlineCode",{parentName:"p"},"React.createContext()"),", called ",(0,a.kt)("inlineCode",{parentName:"p"},"ReactReduxContext"),"."),(0,a.kt)("p",null,"React Redux's ",(0,a.kt)("inlineCode",{parentName:"p"},"<Provider>")," component uses ",(0,a.kt)("inlineCode",{parentName:"p"},"<ReactReduxContext.Provider>")," to put the Redux store and the current store\nstate into context, and ",(0,a.kt)("inlineCode",{parentName:"p"},"connect")," uses ",(0,a.kt)("inlineCode",{parentName:"p"},"<ReactReduxContext.Consumer>")," to read those values and handle updates."),(0,a.kt)("h2",{id:"using-the-usestore-hook"},"Using the ",(0,a.kt)("inlineCode",{parentName:"h2"},"useStore")," Hook"),(0,a.kt)("p",null,"The ",(0,a.kt)("a",{parentName:"p",href:"/react-redux-cn/api/hooks#useStore"},(0,a.kt)("inlineCode",{parentName:"a"},"useStore")," hook")," returns the current store instance from the default ",(0,a.kt)("inlineCode",{parentName:"p"},"ReactReduxContext"),". If you truly need to access the store, this is the recommended approach."),(0,a.kt)("h2",{id:"providing-custom-context"},"Providing Custom Context"),(0,a.kt)("p",null,"Instead of using the default context instance from React Redux, you may supply your own custom context instance."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-jsx"},"<Provider context={MyContext} store={store}>\n  <App />\n</Provider>\n")),(0,a.kt)("p",null,"If you supply a custom context, React Redux will use that context instance instead of the one it creates and exports by default."),(0,a.kt)("p",null,"After you\u2019ve supplied the custom context to ",(0,a.kt)("inlineCode",{parentName:"p"},"<Provider />"),", you will need to supply this context instance to all of your connected components that are expected to connect to the same store:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"// You can pass the context as an option to connect\nexport default connect(\n  mapState,\n  mapDispatch,\n  null,\n  { context: MyContext }\n)(MyComponent)\n\n// or, call connect as normal to start\nconst ConnectedComponent = connect(\n  mapState,\n  mapDispatch\n)(MyComponent)\n\n// Later, pass the custom context as a prop to the connected component\n<ConnectedComponent context={MyContext} />\n")),(0,a.kt)("p",null,"The following runtime error occurs when React Redux does not find a store in the context it is looking. For example:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"You provided a custom context instance to ",(0,a.kt)("inlineCode",{parentName:"li"},"<Provider />"),", but did not provide the same instance (or did not provide any) to your connected components."),(0,a.kt)("li",{parentName:"ul"},"You provided a custom context to your connected component, but did not provide the same instance (or did not provide any) to ",(0,a.kt)("inlineCode",{parentName:"li"},"<Provider />"),".")),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"Invariant Violation"),(0,a.kt)("p",{parentName:"blockquote"},'Could not find "store" in the context of "Connect(MyComponent)". Either wrap the root component in a ',(0,a.kt)("inlineCode",{parentName:"p"},"<Provider>"),", or pass a custom React context provider to ",(0,a.kt)("inlineCode",{parentName:"p"},"<Provider>")," and the corresponding React context consumer to Connect(Todo) in connect options.")),(0,a.kt)("h3",{id:"custom-context-and-the-hooks-api"},"Custom Context and the hooks API"),(0,a.kt)("p",null,"To access the custom context via the hooks API, you can create custom hooks via the ",(0,a.kt)("a",{parentName:"p",href:"/react-redux-cn/api/hooks#custom-context"},"hook creator functions"),"."),(0,a.kt)("h2",{id:"multiple-stores"},"Multiple Stores"),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://redux.js.org/api/store#a-note-for-flux-users"},"Redux was designed to use a single store"),".\nHowever, if you are in an unavoidable position of needing to use multiple stores, as of v6 you may do so by providing (multiple) custom contexts.\nThis also provides a natural isolation of the stores as they live in separate context instances."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"// a naive example\nconst ContextA = React.createContext();\nconst ContextB = React.createContext();\n\n// assuming reducerA and reducerB are proper reducer functions\nconst storeA = createStore(reducerA);\nconst storeB = createStore(reducerB);\n\n// supply the context instances to Provider\nfunction App() {\n  return (\n    <Provider store={storeA} context={ContextA} />\n      <Provider store={storeB} context={ContextB}>\n        <RootModule />\n      </Provider>\n    </Provider>\n  );\n}\n\n// fetch the corresponding store with connected components\n// you need to use the correct context\nconnect(mapStateA, null, null, { context: ContextA })(MyComponentA)\n\n// You may also pass the alternate context instance directly to the connected component instead\n<ConnectedMyComponentA context={ContextA} />\n\n// it is possible to chain connect()\n// in this case MyComponent will receive merged props from both stores\ncompose(\n  connect(mapStateA, null, null, { context: ContextA }),\n  connect(mapStateB, null, null, { context: ContextB })\n)(MyComponent);\n")),(0,a.kt)("h2",{id:"using-reactreduxcontext-directly"},"Using ",(0,a.kt)("inlineCode",{parentName:"h2"},"ReactReduxContext")," Directly"),(0,a.kt)("p",null,"In rare cases, you may need to access the Redux store directly in your own components. This can be done by rendering\nthe appropriate context consumer yourself, and accessing the ",(0,a.kt)("inlineCode",{parentName:"p"},"store")," field out of the context value."),(0,a.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,a.kt)("div",{parentName:"div",className:"admonition-heading"},(0,a.kt)("h5",{parentName:"div"},(0,a.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,a.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,a.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,a.kt)("div",{parentName:"div",className:"admonition-content"},(0,a.kt)("p",{parentName:"div"},"This is ",(0,a.kt)("strong",{parentName:"p"},(0,a.kt)("em",{parentName:"strong"},"not")," considered part of the React Redux public API, and may break without notice"),". We do recognize\nthat the community has use cases where this is necessary, and will try to make it possible for users to build additional\nfunctionality on top of React Redux, but our specific use of context is considered an implementation detail.\nIf you have additional use cases that are not sufficiently covered by the current APIs, please file an issue to discuss\npossible API improvements."))),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-jsx"},"import { ReactReduxContext } from 'react-redux'\n\n// Somewhere inside of a <Provider>\nfunction MyConnectedComponent() {\n  // Access the store via the `useContext` hook\n  const { store } = useContext(ReactReduxContext)\n\n  // alternately, use the render props form of the context\n  /*\n  return (\n    <ReactReduxContext.Consumer>\n      {({ store }) => {\n        // do something useful with the store, like passing it to a child\n        // component where it can be used in lifecycle methods\n      }}\n    </ReactReduxContext.Consumer>\n  )\n  */\n}\n")),(0,a.kt)("h2",{id:"further-resources"},"Further Resources"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"CodeSandbox example: ",(0,a.kt)("a",{parentName:"li",href:"https://codesandbox.io/s/92pm9n2kl4"},"A reading list app with theme using a separate store"),", implemented by providing (multiple) custom context(s)."),(0,a.kt)("li",{parentName:"ul"},"Related issues:",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://github.com/reduxjs/react-redux/issues/1132"},"#1132: Update docs for using a different store key")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://github.com/reduxjs/react-redux/issues/1126"},"#1126: ",(0,a.kt)("inlineCode",{parentName:"a"},"<Provider>")," misses state changes that occur between when its constructor runs and when it mounts"))))))}p.isMDXComponent=!0}}]);