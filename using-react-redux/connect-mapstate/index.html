<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.7">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-130598673-2","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="search" type="application/opensearchdescription+xml" title="React Redux 中文文档" href="/opensearch.xml">
<script src="/scripts/sidebarScroll.js"></script>
<script src="/scripts/codeblock.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js" async></script><title data-react-helmet="true">Connect: Extracting Data with mapStateToProps | React Redux 中文文档</title><meta data-react-helmet="true" property="og:image" content="https://cn.react-redux.js.org/img/redux-logo-landscape.png"><meta data-react-helmet="true" name="twitter:image" content="https://cn.react-redux.js.org/img/redux-logo-landscape.png"><meta data-react-helmet="true" property="og:url" content="https://cn.react-redux.js.org/using-react-redux/connect-mapstate"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" name="twitter:card" content="summary"><meta data-react-helmet="true" property="og:title" content="Connect: Extracting Data with mapStateToProps | React Redux 中文文档"><meta data-react-helmet="true" name="description" content="Usage &gt; mapState: options for reading state with connect"><meta data-react-helmet="true" property="og:description" content="Usage &gt; mapState: options for reading state with connect"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://cn.react-redux.js.org/using-react-redux/connect-mapstate"><link data-react-helmet="true" rel="alternate" href="https://cn.react-redux.js.org/using-react-redux/connect-mapstate" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://cn.react-redux.js.org/using-react-redux/connect-mapstate" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.e0ae6fec.css">
<link rel="preload" href="/assets/js/runtime~main.f31cf6c1.js" as="script">
<link rel="preload" href="/assets/js/main.68fd555e.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/redux.svg" alt="Redux Logo" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/img/redux.svg" alt="Redux Logo" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">React Redux 中文文档</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/introduction/getting-started">入门</a><a class="navbar__item navbar__link" href="/tutorials/quick-start">教程</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/using-react-redux/connect-mapstate">使用指南</a><a class="navbar__item navbar__link" href="/api/hooks">API</a><a href="https://www.github.com/nefe/react-redux-cn" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link github"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a class="navbar__item navbar__link" href="/introduction/getting-started#help-and-discussion">帮助</a><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">🌜</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">🌞</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div><div class="searchBox_NKBi"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist" href="#">简介</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/introduction/getting-started">入门 React Redux</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/introduction/why-use-react-redux">Why Use React Redux?</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist" href="#">教程</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tutorials/quick-start">Quick Start</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tutorials/typescript-quick-start">TypeScript Quick Start</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tutorials/connect">Tutorial: Connect API</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">使用指南</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/using-react-redux/usage-with-typescript">Usage with TypeScript</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/using-react-redux/connect-mapstate">Connect: Extracting Data with mapStateToProps</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/using-react-redux/connect-mapdispatch">Connect: Dispatching Actions with mapDispatchToProps</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/using-react-redux/accessing-store">Accessing the Store</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">API 文档</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">避坑指南</a></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Connect: 使用 <code>mapStateToProps</code> 获取数据</h1></header><p>作为传递给 <code>connect</code> 的第一个参数，<code>mapStateToProps</code> 用于从 store 中选择出连接组件需要的那部分数据。它经常被简称为 <code>mapState</code>。</p><ul><li>每次 store state 变更时都会调用它。</li><li>它接收整个 store state，并应返回组件所需的数据对象。</li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="定义-mapstatetoprops">定义 <code>mapStateToProps</code><a aria-hidden="true" class="hash-link" href="#定义-mapstatetoprops" title="Direct link to heading">​</a></h2><p><code>mapStateToProps</code> 应该被定义为一个函数：</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI js"><pre tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#F92672">function</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">mapStateToProps</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color:#F8F8F2">,</span><span class="token parameter"> ownProps</span><span class="token parameter operator" style="color:#F8F8F2">?</span><span class="token punctuation" style="color:#F8F8F2">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>它应该接受 <code>state</code> 作为第一个参数，可选的第二个参数名为 <code>ownProps</code>，返回一个包含连接组件所需数据的普通对象。</p><p>这个函数应该作为第一个参数传递给 <code>connect</code>，并且每次 Redux store state 发生变化时都会被调用。如果你不想订阅 store，请将 <code>null</code> 或 <code>undefined</code> 代替 <code>mapStateToProps</code>传递给 <code>connect</code>。</p><p><strong><code>mapStateToProps</code> 函数无需考虑是使用 <code>function</code> 关键字（<code>function mapState(state) { }</code> ）还是箭头函数（<code>const mapState = (state) =&gt; { }</code> ）来编写</strong> ——无论哪种方式，它的效果都是一样的。</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="参数">参数<a aria-hidden="true" class="hash-link" href="#参数" title="Direct link to heading">​</a></h3><ol><li><strong><code>state</code></strong></li><li><strong><code>ownProps</code> (可选的)</strong></li></ol><h4 class="anchor anchorWithStickyNavbar_y2LR" id="state"><code>state</code><a aria-hidden="true" class="hash-link" href="#state" title="Direct link to heading">​</a></h4><p><code>mapStateToProps</code> 函数的第一个参数是整个 Redux store state（与调用 <code>store.getState()</code> 返回的值相同）。正因为如此，第一个参数习惯上只是称作 <code>state</code>。（虽然你可以给参数取任何名字，但称它为 <code>store</code> 是不正确的——它是“状态值”，而不是“store 实例”。）</p><p>编写 <code>mapStateToProps</code> 函数时，至少应该传入 <code>state</code>。</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI js"><pre tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#778090">// TodoList.js</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">function</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">mapStateToProps</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">state</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> todos </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> state</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#F92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#F92672">todoList</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> todos</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">allIds</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">export</span><span class="token plain"> </span><span class="token keyword module" style="color:#F92672">default</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">connect</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">mapStateToProps</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token maybe-class-name">TodoList</span><span class="token punctuation" style="color:#F8F8F2">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="ownprops-可选的"><code>ownProps</code> (可选的)<a aria-hidden="true" class="hash-link" href="#ownprops-可选的" title="Direct link to heading">​</a></h4><p>如果你的组件需要利用 props 的数据来检索 store 中的数据，你可以使用第二个参数 <code>ownProps</code> 定义该函数。这个参数将包含所有 props，其来自 <code>connect</code> 生成的 wrapper 组件。</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI js"><pre tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#778090">// Todo.js</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">function</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">mapStateToProps</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color:#F8F8F2">,</span><span class="token parameter"> ownProps</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> visibilityFilter </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> state</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#778090">// ownProps 诸如 { &quot;id&quot; : 123 }</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> id </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> ownProps</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> todo </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">getTodoById</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> id</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#778090">// 组件额外接受的内容</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#F92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> todo</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> visibilityFilter </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#778090">// 之后，你的应用中 render 一个父组件：</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">;</span><span class="token operator" style="color:#F8F8F2">&lt;</span><span class="token maybe-class-name">ConnectedTodo</span><span class="token plain"> id</span><span class="token operator" style="color:#F8F8F2">=</span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token number" style="color:#AE81FF">123</span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">/</span><span class="token operator" style="color:#F8F8F2">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#778090">// 并且你的组件接收了 props.id、props.todo 和 props.visibilityFilter</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>你不需要从 <code>mapStateToProps</code> 返回的对象中包含来自 <code>ownProps</code> 的值。<code>connect</code> 会自动将这些不同的 props 源合并成最终的 props 集合。</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="返回值">返回值<a aria-hidden="true" class="hash-link" href="#返回值" title="Direct link to heading">​</a></h3><p>你的 <code>mapStateToProps</code> 函数应该返回一个包含组件所需数据的普通对象：</p><ul><li>对象中的每个字段都将成为实际组件中的 prop</li><li>字段中的值将用于确定你的组件是否需要重新渲染</li></ul><p>举例来说：</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI js"><pre tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#F92672">function</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">mapStateToProps</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">state</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#F92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token literal-property property" style="color:#F92672">a</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token number" style="color:#AE81FF">42</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token literal-property property" style="color:#F92672">todos</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">todos</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token literal-property property" style="color:#F92672">filter</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">visibilityFilter</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#778090">// 组件会接收到：props.a, props.todos, and props.filter</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><blockquote><p>注意：在需要更多地控制渲染性能的高级场景中，<code>mapStateToProps</code> 也可以返回一个函数。在这种情况下，该函数将用作特定组件实例的最终 <code>mapStateToProps</code>。这允许你执行每个实例的 memoization。有关详细信息，请参阅文档的 <a href="/api/connect">Advanced Usage: Factory Functions</a> 部分，以及 <a href="https://github.com/reduxjs/react-redux/pull/279" target="_blank" rel="noopener noreferrer">PR #279</a> 和它添加的示例。大多数应用程序用不上这个。</p></blockquote><h2 class="anchor anchorWithStickyNavbar_y2LR" id="使用指南">使用指南<a aria-hidden="true" class="hash-link" href="#使用指南" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="让-mapstatetoprops-重塑-store-中的数据">让 <code>mapStateToProps</code> 重塑 Store 中的数据<a aria-hidden="true" class="hash-link" href="#让-mapstatetoprops-重塑-store-中的数据" title="Direct link to heading">​</a></h3><p><code>mapStateToProps</code> 函数可以而且应该做的不仅仅是 <code>return state.someSlice</code>。<strong>他们有责任根据该组件的需要“重新塑造” store 数据。</strong> 这可能包括将值作为特定的 prop 名称返回，组合来自 state tree 不同部分的数据，以及使用不同方式转换 store 的数据。</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="使用-selector-函数提取和转换数据">使用 Selector 函数提取和转换数据<a aria-hidden="true" class="hash-link" href="#使用-selector-函数提取和转换数据" title="Direct link to heading">​</a></h3><p>我们强烈建议使用 selector 函数来封装从 state tree 特定位置取数的逻辑。缓存化的 selector 函数在提高应用程序性能方面也发挥着关键作用（参见本页的以下部分和 <a href="https://redux.js.org/recipes/computing-derived-data" target="_blank" rel="noopener noreferrer">Advanced Usage: Computing Derived Data</a> 页面了解为什么以及如何使用 selector 的更多详细信息。）</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="mapstatetoprops-函数应该快速运行"><code>mapStateToProps</code> 函数应该快速运行<a aria-hidden="true" class="hash-link" href="#mapstatetoprops-函数应该快速运行" title="Direct link to heading">​</a></h3><p>每当 store 发生变化时，所有 connect 过的组件，对应的所有 <code>mapStateToProps</code> 函数都会运行。因此，你的 <code>mapStateToProps</code> 函数应该尽可能快地运行。这也意味着缓慢的 <code>mapStateToProps</code> 函数可能是应用程序中的潜在瓶颈。</p><p>作为“重塑数据”理念的一部分，<code>mapStateToProps</code> 函数经常需要以各种方式转换数据（例如过滤数组、将 ID 数组映射到其对应的对象，或从 Immutable.js 对象中提取普通 JS 值）。无论是在执行转换的成本方面，还是在组件是否因此重新渲染方面，这些转换通常都比较消耗性能。如果性能是一个问题，请确保仅在输入值发生更改时才运行这些转换。</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="mapstatetoprops-函数应该是干净的和同步的"><code>mapStateToProps</code> 函数应该是干净的和同步的<a aria-hidden="true" class="hash-link" href="#mapstatetoprops-函数应该是干净的和同步的" title="Direct link to heading">​</a></h3><p>正如 Redux reducer，<code>mapStateToProps</code> 函数应该始终是 100% 干净和同步的。它应该只接受 <code>state</code>（和 <code>ownProps</code>）作为参数，并返回组件需要的数据作为 props，而不改变这些参数。它 <em>不</em> 应该用于触发异步行为，如获取数据的 AJAX 调用，并且函数不应该被声明为 <code>async</code>。</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="mapstatetoprops-和性能"><code>mapStateToProps</code> 和性能<a aria-hidden="true" class="hash-link" href="#mapstatetoprops-和性能" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="返回值决定你的组件是否重新渲染">返回值决定你的组件是否重新渲染<a aria-hidden="true" class="hash-link" href="#返回值决定你的组件是否重新渲染" title="Direct link to heading">​</a></h3><p>React Redux 在内部实现了 <code>shouldComponentUpdate</code> 方法，这样当组件需要的数据发生变化时，wrapper 组件就会精确地重新渲染。默认情况下，React Redux 针对 <code>mapStateToProps</code> 返回的对象中的每个字段，使用 <code>===</code> 进行比较（“浅对比”检查）以判断其内容是否不同。如果任何字段发生更改，那么你的组件将被重新渲染，以便它可以接收更新的值作为 props。请注意，返回相同引用的 mutated 对象是一个常见错误，可能会导致组件未按预期重新渲染。</p><p>总结一下 <code>connect</code> 包裹的组件与 <code>mapStateToProps</code> 从 store 中提取数据的行为：</p><table><thead><tr><th></th><th><code>(state) =&gt; stateProps</code></th><th><code>(state, ownProps) =&gt; stateProps</code></th></tr></thead><tbody><tr><td><code>mapStateToProps</code> 运行条件：</td><td>store <code>state</code> 变更</td><td>store <code>state</code> 变更 <br> 或者 <br>任何 <code>ownProps</code> 的字段变化</td></tr><tr><td>组件重现渲染条件：</td><td>任何 <code>stateProps</code> 字段变化</td><td>任何 <code>stateProps</code> 的字段变化 <br> 或者 <br> 任何 <code>ownProps</code> 的字段变化</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_y2LR" id="仅在需要时返回新对象引用">仅在需要时返回新对象引用<a aria-hidden="true" class="hash-link" href="#仅在需要时返回新对象引用" title="Direct link to heading">​</a></h3><p>React Redux 会进行浅层比较以查看 <code>mapStateToProps</code> 的结果是否发生了变化。每次都很容易意外地返回新的对象或数组引用，这会导致组件重新渲染，即使数据是相同的。</p><p>对于新的对象或者数组，推荐使用下面的 immutable 操作，返回新的引用</p><ul><li>使用 <code>someArray.map()</code> 或 <code>someArray.filter()</code> 创建新数组</li><li>使用 <code>array.concat</code> 合并数组</li><li>使用 <code>array.slice</code> 选择数组的一部分</li><li>使用 <code>Object.assign</code> 复制值</li><li>使用扩展运算符 <code>{ ...oldState, ...newData }</code> 复制值</li></ul><p>将这些操作放入 <a href="https://redux.js.org/recipes/computing-derived-data#creating-a-memoized-selector" target="_blank" rel="noopener noreferrer">memoized selector functions</a> 以确保它们仅在输入值发生更改时运行。这也将确保如果输入值 <em>没有</em> 改变，<code>mapStateToProps</code> 仍将返回与以前相同的结果值，并且 <code>connect</code> 可以跳过重新渲染。</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="仅在数据更改时执行代价昂贵的操作">仅在数据更改时执行代价昂贵的操作<a aria-hidden="true" class="hash-link" href="#仅在数据更改时执行代价昂贵的操作" title="Direct link to heading">​</a></h3><p>转换数据通常代价昂贵（<em>并且</em> 通常会导致创建新的对象引用）。为了使你的 <code>mapStateToProps</code> 函数尽可能快，你应该只在相关数据发生变化时重新运行这些复杂的转换。</p><p>有几种方法可以解决这个问题：</p><ul><li>一些转换可以在 action creator 或者 reducer 中计算，转换后的数据可以保存在 store 中</li><li>转换也可以在组件的 <code>render()</code> 方法中完成</li><li>如果确实需要在 <code>mapStateToProps</code> 函数中进行转换，我们建议使用 <a href="https://redux.js.org/recipes/computing-derived-data#creating-a-memoized-selector" target="_blank" rel="noopener noreferrer">memoized selector functions</a>以确保仅在输入值发生更改时进行转换。</li></ul><h4 class="anchor anchorWithStickyNavbar_y2LR" id="immutablejs-性能问题">Immutable.js 性能问题<a aria-hidden="true" class="hash-link" href="#immutablejs-性能问题" title="Direct link to heading">​</a></h4><p>Immutable.js 的作者 Lee Byron 在 Twitter <a href="https://twitter.com/leeb/status/746733697093668864?lang=en" target="_blank" rel="noopener noreferrer">explicitly advises avoiding <code>toJS</code> when performance is a concern</a>中写道：</p><blockquote><p>#immutablejs 的性能提示：避免 .toJS() .toObject() 和 .toArray() 缓慢的全复制操作，这会导致结构共享变得无用。</p></blockquote><p>Immutable.js 还需要考虑其他几个性能问题 - 请参阅本页末尾的链接列表以获取更多信息。</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="行为和陷阱">行为和陷阱<a aria-hidden="true" class="hash-link" href="#行为和陷阱" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="mapstatetoprops-在-store-state-相同时不会运行"><code>mapStateToProps</code> 在 Store State 相同时不会运行<a aria-hidden="true" class="hash-link" href="#mapstatetoprops-在-store-state-相同时不会运行" title="Direct link to heading">​</a></h3><p><code>connect</code> 生成的 wrapper 组件订阅了 Redux store。每次 dispatch 一个 action 时，它都会调用 <code>store.getState()</code> 并检查是否 <code>lastState === currentState</code>。如果两个 state 值的引用是相同的，它将 <em>不会</em> 重新运行你的 <code>mapStateToProps</code> 函数，因为它假定 store state 的其余部分也没有改变。</p><p>Redux <code>combineReducers</code> 实用程序函数尝试对此进行优化。如果 slice reducers 都没有返回新的值，则 <code>combineReducers</code> 返回旧 state 对象而不是新 state 对象。这意味着 reducer 中的 mutation 会导致 root state 对象不被更新，因此 UI 不会重新渲染。</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="声明参数的数量影响行为">声明参数的数量影响行为<a aria-hidden="true" class="hash-link" href="#声明参数的数量影响行为" title="Direct link to heading">​</a></h3><p>仅使用 <code>(state)</code>，当 root store state 对象变更，该函数就会运行。使用 <code>(state, ownProps)</code>，它会在 store state 不同时运行，并且在 wrapper props 发生变化时也运行。</p><p>这意味着<strong>你不应该添加 <code>ownProps</code> 参数，除非你真的需要使用它</strong>，否则你的 <code>mapStateToProps</code> 函数会运行得比它需要的更频繁。</p><p>这种行为有一些极端情况。 <strong>强制参数的数量决定了 <code>mapStateToProps</code> 是否会收到 <code>ownProps</code></strong>。</p><p>如果函数的正式定义包含一个强制参数，<code>mapStateToProps</code> 将 <em>不</em> 接收 <code>ownProps</code>：</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI js"><pre tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#F92672">function</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">mapStateToProps</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">state</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">log</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token comment" style="color:#778090">// state</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">log</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">arguments</span><span class="token punctuation" style="color:#F8F8F2">[</span><span class="token number" style="color:#AE81FF">1</span><span class="token punctuation" style="color:#F8F8F2">]</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token comment" style="color:#778090">// undefined</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#E6D874">mapStateToProps</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color:#F8F8F2">,</span><span class="token parameter"> ownProps </span><span class="token parameter operator" style="color:#F8F8F2">=</span><span class="token parameter"> </span><span class="token parameter punctuation" style="color:#F8F8F2">{</span><span class="token parameter punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">log</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token comment" style="color:#778090">// state</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">log</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">ownProps</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token comment" style="color:#778090">// {}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>当函数的正式定义包含零个或两个强制参数时，它 <em>将</em> 接收<code>ownProps</code>：</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI js"><pre tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#F92672">function</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">mapStateToProps</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color:#F8F8F2">,</span><span class="token parameter"> ownProps</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">log</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token comment" style="color:#778090">// state</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">log</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">ownProps</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token comment" style="color:#778090">// ownProps</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">function</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">mapStateToProps</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">log</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">arguments</span><span class="token punctuation" style="color:#F8F8F2">[</span><span class="token number" style="color:#AE81FF">0</span><span class="token punctuation" style="color:#F8F8F2">]</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token comment" style="color:#778090">// state</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">log</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">arguments</span><span class="token punctuation" style="color:#F8F8F2">[</span><span class="token number" style="color:#AE81FF">1</span><span class="token punctuation" style="color:#F8F8F2">]</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token comment" style="color:#778090">// ownProps</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">function</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">mapStateToProps</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter spread operator" style="color:#F8F8F2">...</span><span class="token parameter">args</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">log</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">args</span><span class="token punctuation" style="color:#F8F8F2">[</span><span class="token number" style="color:#AE81FF">0</span><span class="token punctuation" style="color:#F8F8F2">]</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token comment" style="color:#778090">// state</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">log</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">args</span><span class="token punctuation" style="color:#F8F8F2">[</span><span class="token number" style="color:#AE81FF">1</span><span class="token punctuation" style="color:#F8F8F2">]</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token comment" style="color:#778090">// ownProps</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="链接和参考">链接和参考<a aria-hidden="true" class="hash-link" href="#链接和参考" title="Direct link to heading">​</a></h2><p><strong>教程</strong></p><ul><li><a href="https://blog.isquaredsoftware.com/2017/01/practical-redux-part-6-connected-lists-forms-and-performance/" target="_blank" rel="noopener noreferrer">Practical Redux Series, Part 6: Connected Lists, Forms, and Performance</a></li><li><a href="https://blog.isquaredsoftware.com/2017/12/idiomatic-redux-using-reselect-selectors/" target="_blank" rel="noopener noreferrer">Idiomatic Redux: Using Reselect Selectors for Encapsulation and Performance</a></li></ul><p><strong>性能</strong></p><ul><li><a href="https://twitter.com/leeb/status/746733697093668864" target="_blank" rel="noopener noreferrer">Lee Byron&#x27;s Tweet Suggesting to avoid <code>toJS</code>, <code>toArray</code> and <code>toObject</code> for Performance</a></li><li><a href="https://rangle.io/blog/react-and-redux-performance-with-reselect/" target="_blank" rel="noopener noreferrer">Improving React and Redux performance with Reselect</a></li><li><a href="https://github.com/markerikson/react-redux-links/blob/master/react-performance.md#immutable-data" target="_blank" rel="noopener noreferrer">Immutable data performance links</a></li></ul><p><strong>Q&amp;A</strong></p><ul><li><a href="https://redux.js.org/faq/react-redux#why-is-my-component-re-rendering-too-often" target="_blank" rel="noopener noreferrer">Why Is My Component Re-Rendering Too Often?</a></li><li><a href="https://redux.js.org/faq/react-redux#why-isnt-my-component-re-rendering-or-my-mapstatetoprops-running" target="_blank" rel="noopener noreferrer">Why isn&#x27;t my component re-rendering, or my mapStateToProps running</a></li><li><a href="https://redux.js.org/faq/react-redux#how-can-i-speed-up-my-mapstatetoprops" target="_blank" rel="noopener noreferrer">How can I speed up my mapStateToProps?</a></li><li><a href="https://redux.js.org/faq/react-redux#should-i-only-connect-my-top-component-or-can-i-connect-multiple-components-in-my-tree" target="_blank" rel="noopener noreferrer">Should I only connect my top component, or can I connect multiple components in my tree?</a></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/reduxjs/react-redux/edit/master/website/../docs/using-react-redux/connect-extracting-data-with-mapStateToProps.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2022-09-17T03:09:30.000Z">9/17/2022</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/using-react-redux/usage-with-typescript"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« <!-- -->Usage with TypeScript</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/using-react-redux/connect-mapdispatch"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Connect: Dispatching Actions with mapDispatchToProps<!-- --> »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#定义-mapstatetoprops" class="table-of-contents__link toc-highlight">定义 <code>mapStateToProps</code></a><ul><li><a href="#参数" class="table-of-contents__link toc-highlight">参数</a></li><li><a href="#返回值" class="table-of-contents__link toc-highlight">返回值</a></li></ul></li><li><a href="#使用指南" class="table-of-contents__link toc-highlight">使用指南</a><ul><li><a href="#让-mapstatetoprops-重塑-store-中的数据" class="table-of-contents__link toc-highlight">让 <code>mapStateToProps</code> 重塑 Store 中的数据</a></li><li><a href="#使用-selector-函数提取和转换数据" class="table-of-contents__link toc-highlight">使用 Selector 函数提取和转换数据</a></li><li><a href="#mapstatetoprops-函数应该快速运行" class="table-of-contents__link toc-highlight"><code>mapStateToProps</code> 函数应该快速运行</a></li><li><a href="#mapstatetoprops-函数应该是干净的和同步的" class="table-of-contents__link toc-highlight"><code>mapStateToProps</code> 函数应该是干净的和同步的</a></li></ul></li><li><a href="#mapstatetoprops-和性能" class="table-of-contents__link toc-highlight"><code>mapStateToProps</code> 和性能</a><ul><li><a href="#返回值决定你的组件是否重新渲染" class="table-of-contents__link toc-highlight">返回值决定你的组件是否重新渲染</a></li><li><a href="#仅在需要时返回新对象引用" class="table-of-contents__link toc-highlight">仅在需要时返回新对象引用</a></li><li><a href="#仅在数据更改时执行代价昂贵的操作" class="table-of-contents__link toc-highlight">仅在数据更改时执行代价昂贵的操作</a></li></ul></li><li><a href="#行为和陷阱" class="table-of-contents__link toc-highlight">行为和陷阱</a><ul><li><a href="#mapstatetoprops-在-store-state-相同时不会运行" class="table-of-contents__link toc-highlight"><code>mapStateToProps</code> 在 Store State 相同时不会运行</a></li><li><a href="#声明参数的数量影响行为" class="table-of-contents__link toc-highlight">声明参数的数量影响行为</a></li></ul></li><li><a href="#链接和参考" class="table-of-contents__link toc-highlight">链接和参考</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/introduction/getting-started">入门</a></li><li class="footer__item"><a class="footer__link-item" href="/using-react-redux/connect-mapstate">使用指南</a></li><li class="footer__item"><a class="footer__link-item" href="/api/hooks">API 文档</a></li><li class="footer__item"><a class="footer__link-item" href="/troubleshooting">避坑指南</a></li></ul></div><div class="col footer__col"><div class="footer__title">社区</div><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/react-redux" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://discord.gg/0ZcbPKXt5bZ6au5t" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">更多</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/reduxjs/react-redux" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item">
                <a class="github-button" href="https://github.com/reduxjs/react-redux" data-icon="octicon-star" data-count-href="/reduxjs/react-redux/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">
                  Star
                </a>
              </li><li class="footer__item">
                <a href="https://www.netlify.com">
                  <img src="https://www.netlify.com/img/global/badges/netlify-light.svg" alt="Deploys by Netlify">
                </a>
              </li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><img src="/img/redux_white.svg" alt="Redux Logo" class="themedImage_TMUO themedImage--light_4Vu1 footer__logo"><img src="/img/redux_white.svg" alt="Redux Logo" class="themedImage_TMUO themedImage--dark_uzRr footer__logo"></div><div class="footer__copyright">Copyright (c) 2015-present Dan Abramov and the Redux documentation authors.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.f31cf6c1.js"></script>
<script src="/assets/js/main.68fd555e.js"></script>
</body>
</html>